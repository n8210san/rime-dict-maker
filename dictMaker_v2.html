<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å­—å…¸æ•´ç†å™¨ v2.0 - ç¾ä»£åŒ–æ¶æ§‹</title>
  <link rel="stylesheet" href="words.css" />
  <style>
    .module-status {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      z-index: 1000;
    }
    .module-status.ready { background: rgba(0,128,0,0.8); }
    .module-status.loading { background: rgba(255,165,0,0.8); }
    .module-status.error { background: rgba(255,0,0,0.8); }
    
    .text-count {
      margin-top: 4px;
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>
    <div id="moduleStatus" class="module-status loading">è¼‰å…¥ä¸­...</div>
    
    <h2>å­—å…¸æ•´ç†å™¨ v2.0</h2>
    <small><hr><a href="words_v2.html" target="word">æ–·è©æ•´ç†å™¨ v2.0</a><hr></small>

    <div class="controls">
        <button id="openFileBtn">é–‹å•Ÿæª”æ¡ˆ</button>
        <input type="file" id="openFileInput" accept=".txt,.md,.csv,.json,.log,.xml,.html,.htm,text/*" multiple style="display:none" />
        
        <div id="encodingContainer" style="display: inline-block; margin-left: 8px;"></div>
        
        æ’åºå­—å…¸æª”è¨ˆæ•¸ç¯„åœï¼š
        <input type="text" id="rangeInput" placeholder=">300 æˆ– 300-20 æˆ– 50-250" value=">2999" style="height: 40px; width: 180px; padding: 0 8px;" />
        <button id="sortDictBtn">æ’åºå­—å…¸æª”</button>
        <button id="dedupeWithCommentsBtn">è¨»è§£å»é‡â†’Rime</button>
        <button id="normalizeBtn">è£œå®Œæ•´å­—å…¸</button>
        <button id="quickBtn">é€Ÿæˆ</button>
        <button id="fcjBtn">å¿«å€‰</button>
        
        <label title="åœ¨è¼¸å‡ºæ™‚åŠ ä¸ŠåŸå§‹è¨ˆæ•¸" style="margin-left:8px; font-size:13px;">
          <input type="checkbox" id="countOpt"> è¨ˆæ•¸
        </label>
        
        <label title="é¸æ“‡åˆ†éš”ç¬¦" style="margin-left:8px; font-size:13px;">åˆ†éš”ç¬¦:
          <select id="separatorOpt" style="margin-left:4px;">
            <option value="\t">tab</option>
            <option value=" ">ç©ºæ ¼</option>
          </select>
        </label>
        
        <span id="dictMakerCharOptions" style="margin-left:8px;">è¼¸å‡ºè©çµ„å­—æ•¸ï¼š</span>
        
        <br style="clear:both;">
        
        <span class="fcj-options" style="margin-left:8px; font-size:13px; display:inline-flex; gap:10px; align-items:center;">
          <label title="å–®å­—æ¬¡æ•¸ > 1000 ä¸”ç‚º 3 ç¢¼æ™‚ï¼Œå¦åŠ ä¸€åˆ—å·¦å³ç¢¼">
            <input type="checkbox" id="fcjOpt_freq1000_code3_to_code2" checked> å¸¸ç”¨å–®å­—å¦åŠ å·¦å³ç¢¼
          </label>
          <label title="å¸¸ç”¨å–®å­—åŠ ç¢¼é…å¥—ï¼š2ç¢¼å„ªå…ˆ,3ç¢¼å‚™ç”¨">(2ç¢¼å„ªå…ˆ,3ç¢¼å‚™ç”¨)</label>
          <label title="å–®å­—å–ç¢¼ï¼šå‰2ç¢¼+å¾Œ1ç¢¼ï¼ˆä¸è¶…éåŸç¢¼é•·åº¦ï¼‰">å–®å­—å–ç¢¼ 2+1</label>
          <label title="å¤šå­—è©ï¼šå„å­—å–å·¦å³ç¢¼å¾Œä¸²æ¥">è©: å·¦å³ç¢¼æ‹¼æ¥</label>
        </span>
        
        <br>
        <button id="nextStepBtn">â†è¼¸å‡ºè½‰è¼¸å…¥</button>
        <button id="swapBtn">â†äº’æ›â†’</button>
        <button id="undoBtn">å¾©åŸ</button>
        <button id="downloadBtn">ä¸‹è¼‰çµæœ</button>
    </div>

    <div id="textareaContainer"></div>
    
    <div id="statusContainer" style="margin: 12px 0;">
      <div id="excuted_result" style="color: green;">å­—å…¸æ•´ç†å™¨ v2.0 å·²å°±ç·’</div>
    </div>

<footer style="margin:24px 0 12px; padding-top:12px; border-top:1px solid #ddd; font-size:13px; color:#444; display:flex; gap:12px; align-items:flex-start;">
  <div id="flowQuick" style="flex:1 1 0; padding:8px; border:1px solid #ccc; border-radius:6px;">
    <strong>é€Ÿæˆæµç¨‹ v2.0</strong>
    <ol style="margin:6px 0 0 18px;">
      <li>ç¾ä»£åŒ–æ¨¡çµ„æ¶æ§‹ï¼Œçµ±ä¸€ç·¨ç¢¼è™•ç†</li>
      <li>æ™ºèƒ½éŒ¯èª¤è™•ç†å’Œå¿«å–æ©Ÿåˆ¶</li>
      <li>é…ç½®è‡ªå‹•ä¿å­˜å’ŒåŒæ­¥</li>
    </ol>
  </div>
  <div id="flowFCJ" style="flex:1 1 0; padding:8px; border:1px solid #ccc; border-radius:6px;">
    <strong>å¿«å€‰æµç¨‹ v2.0</strong>
    <ol style="margin:6px 0 0 18px;">
      <li>çµ±ä¸€çš„å­—æ•¸éæ¿¾å’ŒUIç®¡ç†</li>
      <li>äº‹ä»¶é©…å‹•çš„æ¨¡çµ„é€šä¿¡</li>
      <li>å®Œæ•´çš„æ’¤éŠ·/é‡åšç³»çµ±</li>
    </ol>
  </div>
</footer>

<!-- ç¾ä»£åŒ–æ¨¡çµ„ç³»çµ± -->
<script src="scripts/jquery-3.7.1.slim.min.js"></script>
<script src="scripts/modules/core.js"></script>
<script src="scripts/modules/config.js"></script>
<script src="scripts/modules/cangjie.js"></script>
<script src="scripts/modules/charFilter.js"></script>
<script src="scripts/modules/ui.js"></script>
<script src="scripts/modules/app.js"></script>

<script>
// æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å™¨
$(async function() {
  const $status = $('#moduleStatus');
  
  try {
    $status.text('è¼‰å…¥æ¨¡çµ„ç³»çµ±...').removeClass().addClass('module-status loading');
    
    // æª¢æŸ¥æ¨¡çµ„ç³»çµ±æ˜¯å¦å¯ç”¨
    if (typeof ModuleSystem === 'undefined') {
      throw new Error('ModuleSystem æœªå®šç¾©ï¼Œè«‹æª¢æŸ¥ scripts/modules/core.js æ˜¯å¦è¼‰å…¥æˆåŠŸ');
    }
    
    // åˆå§‹åŒ–æ¨¡çµ„ç³»çµ±
    const result = await ModuleSystem.init([
      'config', 'cangjie', 'charFilter', 'ui', 'app'
    ]);
    
    if (result.failed.length > 0) {
      const failedDetails = result.failed.map(f => `${f.name}: ${f.error.message}`).join('; ');
      throw new Error(`æ¨¡çµ„è¼‰å…¥å¤±æ•—: ${failedDetails}`);
    }
    
    // ç²å–æ‡‰ç”¨ç¨‹å¼å¯¦ä¾‹
    const app = await ModuleSystem.get('app');
    const ui = await ModuleSystem.get('ui');
    
    // è¨­ç½®UIçµ„ä»¶
    ui.createEncodingSelect('#encodingContainer');
    ui.createDualTextareas('#textareaContainer', {
      inputPlaceholder: 'è«‹åœ¨æ­¤è¼¸å…¥å­—å…¸...',
      showCounts: true
    });
    
    // ç›£è½æ‡‰ç”¨ç¨‹å¼äº‹ä»¶
    app.on('appReady', (data) => {
      console.log('ğŸ‰ æ‡‰ç”¨ç¨‹å¼å·²å°±ç·’:', data);
      $status.text('v2.0 å·²å°±ç·’').removeClass().addClass('module-status ready');
    });
    
    app.on('statusUpdate', (data) => {
      console.log('ğŸ“Š ç‹€æ…‹æ›´æ–°:', data);
    });
    
    // æ·»åŠ é–‹ç™¼è€…å·¥å…·
    global.dev = {
      getModuleStatus: () => ModuleSystem.status(),
      getAppStatus: () => app.getAppStatus(),
      reloadModule: (name) => ModuleSystem.core.reload(name),
      getModule: (name) => ModuleSystem.get(name)
    };
    
    console.log('ğŸ”§ é–‹ç™¼è€…å·¥å…·å·²è¼‰å…¥ï¼Œä½¿ç”¨ dev.* è¨ªå•');
    
  } catch (error) {
    console.error('ğŸ’¥ æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å¤±æ•—:', error);
    $status.text('è¼‰å…¥å¤±æ•—').removeClass().addClass('module-status error');
    
    // é¡¯ç¤ºè©³ç´°éŒ¯èª¤ä¿¡æ¯
    $status.append(`<br><small>éŒ¯èª¤: ${error.message}</small>`);
    $status.append('<br><small>è«‹æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°ä»¥ç²å–è©³ç´°ä¿¡æ¯</small>');
    $status.append('<br><small>5ç§’å¾Œå°‡è¼‰å…¥å‚™ç”¨ç‰ˆæœ¬...</small>');
    
    // å»¶é•·ç­‰å¾…æ™‚é–“ï¼Œè®“ç”¨æˆ¶çœ‹åˆ°éŒ¯èª¤ä¿¡æ¯
    setTimeout(() => {
      if (confirm('æ¨¡çµ„ç³»çµ±è¼‰å…¥å¤±æ•—ã€‚é»æ“Šç¢ºå®šè¼‰å…¥å‚³çµ±ç‰ˆæœ¬ï¼Œé»æ“Šå–æ¶ˆç•™åœ¨æ­¤é é¢é€²è¡Œèª¿è©¦ã€‚')) {
        window.location.href = 'dictMaker.html';
      } else {
        $status.text('å·²å–æ¶ˆè·³è½‰ï¼Œè«‹æŸ¥çœ‹æ§åˆ¶å°é€²è¡Œèª¿è©¦').removeClass().addClass('module-status error');
      }
    }, 5000);
  }
});

// å¿«æ·éµæ”¯æ´
$(document).on('keydown', function(e) {
  if (e.ctrlKey || e.metaKey) {
    switch(e.key) {
      case 'z':
        e.preventDefault();
        $('#undoBtn').click();
        break;
      case 's':
        e.preventDefault();
        $('#downloadBtn').click();
        break;
    }
  }
});
</script>

</body>
</html>