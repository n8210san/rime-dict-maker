# dedupeWithComments_v1 å‡½æ•¸è¨˜éŒ„

## ğŸ“‹ æ¦‚è¿°
`dedupeWithComments_v1` æ˜¯è¨»è§£å»é‡åŠŸèƒ½çš„åŸå§‹ç‰ˆæœ¬ï¼Œæ¡ç”¨ä¸‰æ®µå¼è™•ç†æµç¨‹ï¼Œèƒ½å¤ å®Œæ•´ä¿ç•™è¨»è§£å’Œç©ºè¡Œçš„ä½ç½®ã€‚

## ğŸ’» å®Œæ•´ç¨‹å¼ç¢¼

```javascript
// è¨»è§£å»é‡åŠŸèƒ½ -- v1 : é©ç”¨å¤§å‹æª”æ¡ˆ
function dedupeWithComments_v1() {
  const raw = $('#inputTextarea').val() || '';
  const lines = raw.split(/\r?\n/);
  let skipId = 0;

  // ç¬¬ä¸€æ®µï¼šç‚ºè¨»è§£å’Œç©ºè¡Œæ·»åŠ  __skip__{id} æ¨™è¨˜
  const processedLines = [];
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i];
    const trimmed = line.trim();

    // ç©ºè¡Œå’Œè¨»è§£æ·»åŠ æ¨™è¨˜
    if (!trimmed || trimmed.startsWith('#')) {
      processedLines.push(`__skip__${skipId++} ${line}`);
    } else {
      processedLines.push(line);
    }
  }

  // ç¬¬äºŒæ®µï¼šè™•ç†å¾Œå…§å®¹é€²è¡Œå»é‡
  const seen = new Map();

  for (let i = 0; i < processedLines.length; i++) {
    const line = processedLines[i].trim();

    // è·³é __skip__ æ¨™è¨˜è¡Œ
    if (line.startsWith('__skip__')) continue;

    // è§£æè³‡æ–™
    const parts = line.split(/\s+/);
    if (parts.length < 2) continue;

    let root = '', word = '', count = 1;

    // åˆ¤æ–·å­—æ ¹å’Œè©å½™ä½ç½®
    if (/^[a-z]+$/.test(parts[0])) {
      root = parts[0];
      word = parts[1];
      if (parts[2] && /^\d+$/.test(parts[2])) {
        count = parseInt(parts[2], 10);
      }
    } else if (/^[a-z]+$/.test(parts[1])) {
      word = parts[0];
      root = parts[1];
      if (parts[2] && /^\d+$/.test(parts[2])) {
        count = parseInt(parts[2], 10);
      }
    } else {
      continue;
    }

    const key = root + '|' + word;

    if (!seen.has(key)) {
      seen.set(key, { root: root, word: word, count: count, index: i, originalLine: line });
    } else {
      const existing = seen.get(key);
      existing.count += count;
      // æ¨™è¨˜è©²è¡Œç‚ºå·²è™•ç†
      processedLines[i] = `__processed__${i}`;
    }
  }

  // ç¬¬ä¸‰æ®µï¼šç”¢ç”Ÿå»é‡è¼¸å‡º
  const separator = $('#separatorOpt').val().replace(/\\t/g, '\t') || ' ';
  const dedupeMap = new Map();

  // å»ºç«‹å»é‡å¾Œè³‡æ–™è¡¨
  for (const [key, data] of seen.entries()) {
    const newLine = `${data.word}${separator}${data.root}${separator}${data.count}`;
    dedupeMap.set(data.index, newLine);
  }

  // ç¬¬å››æ®µï¼šçµ„åˆæœ€çµ‚è¼¸å‡ºï¼Œç§»é™¤æ¨™è¨˜
  const result = [];
  for (let i = 0; i < processedLines.length; i++) {
    const line = processedLines[i];

    if (line.startsWith('__skip__')) {
      // ç§»é™¤ __skip__{id} æ¨™è¨˜ï¼Œæ¢å¾©åŸå§‹è¡Œ
      const originalLine = line.replace(/^__skip__\d+\s*/, '');
      result.push(originalLine);
    } else if (line.startsWith('__processed__')) {
      // è·³éå·²è¢«åˆä½µçš„é‡è¤‡è¡Œ
      continue;
    } else if (dedupeMap.has(i)) {
      // ä½¿ç”¨å»é‡å¾Œè³‡æ–™
      result.push(dedupeMap.get(i));
    } else {
      // ä¿ç•™å…¶ä»–è³‡æ–™
      result.push(line);
    }
  }

  $('#outputTextarea').val(result.join('\n'));

  // æ›´æ–°è¨ˆæ•¸
  const $outCount = $('#outputCount');
  if ($outCount.length) {
    $outCount.text(`ç¸½è¨ˆ ${result.length} è¡Œ`);
  }

  const $meta = $('#outputMeta');
  if ($meta.length) {
    $meta.text('æœ¬æ¬¡ä½¿ç”¨ï¼šè¨»è§£å»é‡');
    $('#flowQuick, #flowFCJ').css({ borderColor: '#ccc' });
  }
}
```

## ğŸ”„ v1 vs v2 æ¯”è¼ƒ (è©³ç´° Docstring)

### ğŸ’š v1 å„ªé»

#### 1. åŠŸèƒ½å®Œæ•´
- **ç²¾ç¢ºä½ç½®ä¿ç•™**ï¼šä½¿ç”¨ `__skip__` æ¨™è¨˜ç³»çµ±ï¼Œèƒ½ç²¾ç¢ºä¿ç•™è¨»è§£å’Œç©ºè¡Œçš„åŸå§‹ä½ç½®
- **å››æ®µå¼è™•ç†**ï¼šé‚è¼¯æ¸…æ™°åˆ†é›¢ï¼Œæ¯æ®µè·è²¬æ˜ç¢º
- **å®Œæ•´éŒ¯èª¤è™•ç†**ï¼šå°å„ç¨®æ ¼å¼ç•°å¸¸éƒ½æœ‰é©ç•¶è™•ç†

#### 2. è¨˜æ†¶é«”å‹å–„
- **ä¸²æµè™•ç†**ï¼šé€è¡Œè™•ç†ï¼Œä¸éœ€è¦å¤§é‡è‡¨æ™‚ç‰©ä»¶
- **åœ°åœ–ç´¢å¼•**ï¼šä½¿ç”¨ Map çµæ§‹é«˜æ•ˆæŸ¥æ‰¾å’Œæ›´æ–°
- **æ¨™è¨˜å¾©ç”¨**ï¼š`__skip__` å’Œ `__processed__` æ¨™è¨˜é‡è¤‡ä½¿ç”¨

#### 3. å¯æ“´å±•æ€§
- **æ¨¡çµ„åŒ–è¨­è¨ˆ**ï¼šå„æ®µç¨ç«‹ï¼Œå®¹æ˜“æ·»åŠ æ–°åŠŸèƒ½
- **æ¨™è¨˜ç³»çµ±**ï¼šå¯æ”¯æ´æ›´å¤šé¡å‹çš„ç‰¹æ®Šè™•ç†
- **éˆæ´»æ ¼å¼**ï¼šæ”¯æ´å¤šç¨®åˆ†éš”ç¬¦å’Œæ ¼å¼è®ŠåŒ–

#### 4. èª¿è©¦å‹å–„
- **æµç¨‹æ¸…æ™°**ï¼šå››æ®µå¼æµç¨‹å®¹æ˜“è¿½è¹¤å’Œèª¿è©¦
- **ä¸­é–“ç‹€æ…‹**ï¼šå¯æª¢æŸ¥æ¯æ®µçš„è™•ç†çµæœ
- **éŒ¯èª¤å®šä½**ï¼šå®¹æ˜“ç¢ºå®šå•é¡Œç™¼ç”Ÿåœ¨å“ªä¸€æ®µ

### âŒ v1 ç¼ºé»

#### 1. è¨˜æ†¶é«”ä½¿ç”¨
- **å­—ç¬¦ä¸²æ“ä½œ**ï¼šå¤šæ¬¡å­—ç¬¦ä¸²æ·»åŠ å’Œç§»é™¤ `__skip__` æ¨™è¨˜ï¼Œç”¢ç”Ÿè¨˜æ†¶é«”åƒåœ¾
- **è‡¨æ™‚é™£åˆ—**ï¼š`processedLines` é™£åˆ—ä½”ç”¨é¡å¤–è¨˜æ†¶é«”
- **æ¨™è¨˜é–‹éŠ·**ï¼šæ¯å€‹è¨»è§£è¡Œéƒ½éœ€è¦æ·»åŠ æ¨™è¨˜å­—ç¬¦ä¸²

#### 2. é‚è¼¯è¤‡é›œæ€§
- **ç´¢å¼•ä¾è³´**ï¼šä¾è³´ç´¢å¼•é—œä¿‚ï¼Œè¼ƒå®¹æ˜“å‡ºéŒ¯
- **å¤šæ¬¡éæ­·**ï¼šéœ€è¦ 3-4 æ¬¡éæ­·æ‰èƒ½å®Œæˆï¼Œè¤‡é›œåº¦ç‚º O(3n~4n)
- **æ¨™è¨˜ç®¡ç†**ï¼šéœ€è¦é¡å¤–ç®¡ç†å’Œæ¸…ç†æ¨™è¨˜ç³»çµ±

#### 3. æ€§èƒ½å•é¡Œ
- **å­—ç¬¦ä¸²è§£æ**ï¼šå¤šæ¬¡ split å’Œ replace æ“ä½œ
- **æ­£å‰‡è¡¨é”å¼**ï¼šé‡è¤‡ä½¿ç”¨æ­£å‰‡è¡¨é”å¼åŒ¹é…
- **è¨˜æ†¶é«”å³°å€¼**ï¼šè™•ç†å¤§æª”æ¡ˆæ™‚è¨˜æ†¶é«”ä½¿ç”¨å³°å€¼è¼ƒé«˜

#### 4. ç¶­è­·è¤‡é›œ
- **ç‹€æ…‹ç®¡ç†**ï¼šéœ€è¦ç¶­è­·å¤šç¨®ç‹€æ…‹ï¼ˆskip, processed ç­‰ï¼‰
- **é‚Šç•Œæ¢ä»¶**ï¼šæ¨™è¨˜è™•ç†çš„é‚Šç•Œæ¢ä»¶è¼ƒå¤š
- **èª¿è©¦å›°é›£**ï¼šå‡ºéŒ¯æ™‚è¼ƒé›£è¿½è¹¤å“ªä¸€è¡Œè¢«å¦‚ä½•è™•ç†

---

### ğŸš€ v2 æ”¹é€² (æ™ºèƒ½è¨»è§£å»é‡ + è‡ªå‹•æ ¼å¼æ¨™æº–åŒ–)

#### å„ªé»
1. **æ€§èƒ½æå‡**
   - **ä¸€æ¬¡éæ­·**ï¼šæ ¸å¿ƒé‚è¼¯åªéœ€ä¸€æ¬¡éæ­·ï¼ŒO(n) æ™‚é–“è¤‡é›œåº¦
   - **æ¸›å°‘å­—ç¬¦ä¸²æ“ä½œ**ï¼šä¸éœ€è¦æ·»åŠ ç§»é™¤ `__skip__` æ¨™è¨˜ï¼Œæ¸›å°‘å­—ç¬¦ä¸²åƒåœ¾
   - **ç›´æ¥ç´¢å¼•è¨ªå•**ï¼šä½¿ç”¨ `result[i]` ç›´æ¥å®šä½ï¼Œå¿«é€ŸæŸ¥æ‰¾

2. **è¨˜æ†¶é«”å„ªåŒ–**
   - **é åˆ†é…é™£åˆ—**ï¼š`new Array(lines.length)` é åˆ†é…å®¹é‡
   - **å°±åœ°ä¿®æ”¹**ï¼šç›´æ¥åœ¨çµæœé™£åˆ—ä¸­è¨˜éŒ„ä¿®æ”¹ï¼Œä¸éœ€è¦é¡å¤–å„²å­˜
   - **ç°¡å–®è³‡æ–™çµæ§‹**ï¼š`Object.create(null)` æ¯” Map ç¨å¾®è¼•é‡ä¸€é»

3. **é‚è¼¯ç°¡åŒ–**
   - **ç·šæ€§é‚è¼¯**ï¼šä¸€æ¬¡éæ­·å®Œæˆæ ¸å¿ƒä»»å‹™
   - **ç‹€æ…‹ç®¡ç†ç°¡å–®**ï¼šä¸éœ€è¦è¤‡é›œçš„æ¨™è¨˜ç³»çµ±
   - **ä»£ç¢¼é‡æ¸›å°‘**ï¼šæ¸›å°‘ç´„ 50% çš„ä»£ç¢¼é‡

4. **åŠŸèƒ½å¢å¼·**
   - **æµç¨‹æ¸…æ™°**ï¼šè™•ç†é‚è¼¯æ›´ç·šæ€§ï¼Œå®¹æ˜“ç†è§£
   - **è®Šæ•¸å‘½åæ¸…æ¥š**ï¼šp0, p1, p2 ç°¡æ½”æ˜ç­
   - **è‡ªå‹•æ ¼å¼æ¨™æº–åŒ–**ï¼šæ•´åˆ `needsNormalization` å’Œ `normalizeDictionary` åŠŸèƒ½

#### ç¼ºé»
1. **è¨˜æ†¶é«”ä½¿ç”¨**
   - **ç©ºé–“æµªè²»**ï¼šresult é™£åˆ—å¤§å°ç­‰æ–¼è¼¸å…¥è¡Œæ•¸ï¼Œæœ€çµ‚å¯èƒ½å¾ˆå¤š null
   - **è‡¨æ™‚å°è±¡éŠ·æ¯€**ï¼šéœ€è¦åœ¨æœ€å¾Œç”¨ filter ç§»é™¤ nullï¼Œåœ¨è¨˜æ†¶é«”ä¸­ä½”ä½

2. **é‚è¼¯è¤‡é›œæ€§**
   - **ç´¢å¼•ä¾è³´**ï¼šä¾è³´ç´¢å¼•é—œä¿‚ï¼Œè¼ƒå®¹æ˜“å‡ºéŒ¯
   - **null è™•ç†**ï¼šéœ€è¦é¡å¤– filter æ­¥é©Ÿç§»é™¤ null

3. **å¯æ“´å±•æ€§**
   - **ç·Šè€¦åˆæ¨¡å¼**ï¼šè‹¥æœªä¾†éœ€è¦å…¶ä»–é¡å‹æ¨™è¨˜è™•ç†è¼ƒé›£æ“´å……
   - **èª¿è©¦å›°é›£**ï¼šå‡ºéŒ¯æ™‚è¼ƒé›£è¿½è¹¤æŸè¡Œè¢«å¦‚ä½•è™•ç†

4. **æ•ˆèƒ½è€ƒé‡**
   - **ç¨€ç–é™£åˆ—**ï¼šå¤§æª”æ¡ˆè™•ç†æ™‚ç¨€ç–é™£åˆ— filter æˆæœ¬è¼ƒé«˜
   - **è¨˜æ†¶é«”å³°å€¼**ï¼šé™£åˆ—å¾é–‹å§‹åˆ°çµæŸéƒ½å­˜åœ¨

## ğŸ¯ çµè«–

- **v1** é©ç”¨æ–¼éœ€è¦ç²¾ç¢ºä½ç½®æ§åˆ¶å’Œè¤‡é›œæ ¼å¼è™•ç†çš„å ´æ™¯
- **v2** é©ç”¨æ–¼ä¸€èˆ¬å»é‡éœ€æ±‚ï¼Œæ•ˆèƒ½å’Œè¨˜æ†¶é«”ä½¿ç”¨éƒ½æ›´å„ª
- **é¸æ“‡æ¨™æº–**ï¼šæ ¹æ“šæª”æ¡ˆå¤§å°ã€è¨˜æ†¶é«”é™åˆ¶å’ŒåŠŸèƒ½éœ€æ±‚ä¾†æ±ºå®šä½¿ç”¨å“ªå€‹ç‰ˆæœ¬

## ğŸ“ å‚™è¨»

æ­¤å‡½æ•¸åœ¨é‡æ§‹éç¨‹ä¸­è¢«ç§»é™¤ï¼Œæ”¹ç”¨ v2 ç‰ˆæœ¬çš„ `performDeduplication` å‡½æ•¸ã€‚è¨˜éŒ„ä¿å­˜ä»¥ä¾›æ—¥å¾Œåƒè€ƒå’Œæ¯”è¼ƒç ”ç©¶ã€‚