# 🚨 重構檢查工作清單

## ⚠️ 嚴重警告
文件中提到的"智能模式"、"瘦身成果"、"v2功能" 可能是錯誤的！
必須確保所有功能與原版本完全一致，不可擅自簡化或變更計算邏輯！

---

## 🚨 **發現嚴重問題！**

### ❌ **不當修改清單**
1. **utils.js 被錯誤修改** - 加入了"智能模式切換"和 ModuleSystem 檢測邏輯
2. **新增了 6 個 v2 模組檔案** - `scripts/modules/` 目錄 (app.js, cangjie.js, charFilter.js, config.js, core.js, ui.js)
3. **新增了 5 個 v2 HTML 檔案** - 全部包含 ModuleSystem 邏輯
4. **可能有其他檔案被不當簡化或修改**

### ⚡ **立即行動項目**
- [x] **立即檢查 git 歷史**，確認所有變更
- [ ] **回復 utils.js 到原始狀態** - ❌ 禁止任意變更 git
- [ ] **檢查是否有其他檔案被不當瘦身**
- [x] **確認原始功能是否完整** - ✅ 已透過 subagent 檢查並修正

### ✅ **已完成修正項目**
- [x] **P1: streamFilterDict 進度回報格式** - Coder 已修正 total 屬性問題
- [x] **P1: 清理倉頡編碼函式重複定義** - Coder 已統一實作並移除重複
- [x] **P2: 補強 ModuleSystem 相容層** - 已修正 FcjUtils.cjMakeFromText 缺失問題

---

## 📋 需要檢查的重構項目

### 🔍 **已提取的模組檢查**

#### ✅ rangeFilter.js (新增)
- [ ] `buildRangeFilter()` - 範圍條件解析器
  - 檢查項目：支援格式是否與原版一致 (">N", ">=N", "<N", "<=N", "A-B", 單一數字)
  - 原始位置：dictMaker.js
  - 風險：可能簡化了邊界條件處理

- [ ] `streamFilterDict()` - 串流字典過濾器  
  - 檢查項目：串流處理邏輯是否完整
  - 原始位置：dictMaker.js
  - 風險：可能遺漏了編碼處理、進度回報細節

#### ✅ cangjieProcessor.js (新增)
- [ ] `loadCangjieDict()` - 載入倉頡字典
  - 檢查項目：字典解析邏輯是否與原版一致
  - 原始位置：dictMaker.js
  - 風險：可能改變了註解過濾、格式處理

- [ ] `pickQuick()` - 速成編碼 
  - 檢查項目：編碼規則 (左1+右1) 是否正確實作
  - 原始位置：dictMaker.js  
  - 風險：⚠️ 已發現錯誤描述，需確認實作邏輯

- [ ] `pickFCJ()` - 快倉編碼
  - 檢查項目：編碼規則 (左2+右1) 是否正確實作  
  - 原始位置：dictMaker.js
  - 風險：⚠️ 已發現錯誤描述，需確認實作邏輯

### 🔍 **可能被修改的原始檔案**

#### ❗ dictMaker.js (被大幅修改)
- [ ] 檢查移除的函數是否有遺漏的邏輯
- [ ] 確認剩餘的按鈕事件處理是否完整
- [ ] 驗證字典處理流程是否保持原有功能

#### ❗ words.js (可能被修改)  
- [ ] `prepare()` 函數 - 新增了字數篩選邏輯
  - 檢查項目：是否影響原有的語言篩選和去重邏輯
  - 風險：可能改變了處理流程或結果格式

- [ ] `getUnifiedCharLengthFilter()` 函數 - 新增函數
  - 檢查項目：是否與原有的字數過濾邏輯一致
  - 風險：可能引入不必要的複雜性

#### ❗ utils.js (可能被瘦身)
- [ ] 檢查是否有"智能模式切換"邏輯
- [ ] 確認核心函數是否被簡化
- [ ] 驗證配置管理功能是否完整

### 🔍 **HTML 檔案載入順序檢查**

#### ❗ dictMaker.html
- [ ] 新增的 rangeFilter.js 載入順序是否正確
- [ ] 新增的 cangjieProcessor.js 載入順序是否正確
- [ ] 是否影響原有功能

#### ❗ words.html  
- [ ] 腳本載入順序是否正確
- [ ] 新增依賴是否必要

### 🔍 **功能完整性檢查**

#### 🎯 sortDictBtn 按鈕功能
- [ ] 是否完全恢復原有功能
- [ ] 範圍篩選是否正確運作
- [ ] 字數過濾是否與原版一致

#### 🎯 simpleBtn & punctuationSortCountBtn
- [ ] 字數篩選邏輯是否正確
- [ ] 是否影響原有的斷句和計數功能

---

## 🚨 **重點檢查項目**

### 1. 計算邏輯完整性
- [ ] 倉頡編碼規則是否與原版完全一致
- [ ] 範圍過濾演算法是否有變更
- [ ] 字數統計邏輯是否保持原有精度

### 2. 向後相容性
- [ ] 所有原有的全域函數是否可用
- [ ] API 介面是否保持不變
- [ ] 錯誤處理是否與原版一致

### 3. 效能影響
- [ ] 是否有不必要的重複載入
- [ ] 模組依賴是否合理
- [ ] 記憶體使用是否增加

---

## 📝 **檢查方法**

1. **功能測試**：逐一測試每個按鈕和功能
2. **代碼比對**：與 git 歷史比較，確認所有變更
3. **邏輯驗證**：確保計算結果與原版完全一致
4. **邊界測試**：測試極端情況和錯誤處理

---

## ⚡ **立即行動**

**優先級 1 (立即檢查):**
- [ ] 倉頡編碼函數的實際邏輯
- [ ] 範圍過濾器的完整性  
- [ ] words.js 的 prepare() 函數變更

**優先級 2 (詳細驗證):**
- [ ] 所有按鈕功能測試
- [ ] HTML 載入順序驗證
- [ ] utils.js 是否被不當修改

**優先級 3 (清理檢查):**
- [ ] 移除任何 v2 相關的錯誤功能
- [ ] 確認沒有不必要的複雜化
- [ ] 驗證所有檔案的一致性

---

## 📋 **結論要求**

**每個檢查項目必須確保：**
1. ✅ 功能與原版完全一致
2. ✅ 無擅自的邏輯簡化
3. ✅ 無不必要的複雜化
4. ✅ 保持 DIY 原則和演算法效率
5. ✅ 零破壞性變更

**如發現任何偏差，立即回復到正確的原版邏輯！**