<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>v2.0 ç³»çµ±èª¿è©¦å·¥å…·</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
    .success { color: green; }
    .error { color: red; }
    .warning { color: orange; }
    .info { color: blue; }
    pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    button { margin: 5px; padding: 8px 16px; }
  </style>
</head>
<body>
  <h1>ğŸ”§ v2.0 æ¨¡çµ„ç³»çµ±èª¿è©¦å·¥å…·</h1>
  
  <div class="test-section">
    <h3>1. æª”æ¡ˆè¼‰å…¥æª¢æŸ¥</h3>
    <button onclick="checkFiles()">æª¢æŸ¥æ‰€æœ‰æ¨¡çµ„æª”æ¡ˆ</button>
    <div id="fileResults"></div>
  </div>

  <div class="test-section">
    <h3>2. æ¨¡çµ„ç³»çµ±åˆå§‹åŒ–æ¸¬è©¦</h3>
    <button onclick="testModuleSystem()">æ¸¬è©¦æ¨¡çµ„ç³»çµ±</button>
    <div id="moduleResults"></div>
  </div>

  <div class="test-section">
    <h3>3. å€‹åˆ¥æ¨¡çµ„æ¸¬è©¦</h3>
    <button onclick="testIndividualModules()">æ¸¬è©¦å„æ¨¡çµ„</button>
    <div id="individualResults"></div>
  </div>

  <div class="test-section">
    <h3>4. æ‡‰ç”¨ç¨‹å¼å®Œæ•´æ¸¬è©¦</h3>
    <button onclick="testFullApp()">å®Œæ•´æ¸¬è©¦</button>
    <div id="appResults"></div>
  </div>

  <div class="test-section">
    <h3>5. éŒ¯èª¤æ—¥èªŒ</h3>
    <button onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
    <button onclick="downloadLog()">ä¸‹è¼‰æ—¥èªŒ</button>
    <pre id="errorLog"></pre>
  </div>

<script src="scripts/jquery-3.7.1.slim.min.js"></script>
<script src="scripts/modules/core.js"></script>
<script src="scripts/modules/config.js"></script>
<script src="scripts/modules/cangjie.js"></script>
<script src="scripts/modules/charFilter.js"></script>
<script src="scripts/modules/ui.js"></script>
<script src="scripts/modules/app.js"></script>

<script>
// éŒ¯èª¤æ”¶é›†å™¨
const errorLog = [];
const originalConsoleError = console.error;
const originalConsoleWarn = console.warn;

console.error = function(...args) {
  errorLog.push({ type: 'error', timestamp: new Date().toISOString(), message: args.join(' ') });
  updateErrorLog();
  return originalConsoleError.apply(console, args);
};

console.warn = function(...args) {
  errorLog.push({ type: 'warning', timestamp: new Date().toISOString(), message: args.join(' ') });
  updateErrorLog();
  return originalConsoleWarn.apply(console, arguments);
};

function updateErrorLog() {
  const $log = $('#errorLog');
  const logText = errorLog.map(entry => 
    `[${entry.timestamp}] ${entry.type.toUpperCase()}: ${entry.message}`
  ).join('\n');
  $log.text(logText);
}

function clearLog() {
  errorLog.length = 0;
  updateErrorLog();
}

function downloadLog() {
  const logText = errorLog.map(entry => 
    `[${entry.timestamp}] ${entry.type.toUpperCase()}: ${entry.message}`
  ).join('\n');
  
  const blob = new Blob([logText], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `debug_log_${new Date().toISOString().replace(/[:.]/g, '-')}.txt`;
  document.body.appendChild(a);
  a.click();
  URL.revokeObjectURL(url);
  a.remove();
}

// æª¢æŸ¥æª”æ¡ˆè¼‰å…¥
async function checkFiles() {
  const $results = $('#fileResults');
  $results.html('<p>æª¢æŸ¥ä¸­...</p>');
  
  const files = [
    'scripts/jquery-3.7.1.slim.min.js',
    'scripts/modules/core.js',
    'scripts/modules/config.js', 
    'scripts/modules/cangjie.js',
    'scripts/modules/charFilter.js',
    'scripts/modules/ui.js',
    'scripts/modules/app.js'
  ];
  
  const results = [];
  
  for (const file of files) {
    try {
      const resp = await fetch(file);
      if (resp.ok) {
        results.push(`<span class="success">âœ… ${file} (${resp.status})</span>`);
      } else {
        results.push(`<span class="error">âŒ ${file} (${resp.status})</span>`);
      }
    } catch (error) {
      results.push(`<span class="error">âŒ ${file} (è¼‰å…¥å¤±æ•—: ${error.message})</span>`);
    }
  }
  
  $results.html(results.join('<br>'));
}

// æ¸¬è©¦æ¨¡çµ„ç³»çµ±
async function testModuleSystem() {
  const $results = $('#moduleResults');
  $results.html('<p>æ¸¬è©¦ä¸­...</p>');
  
  const tests = [];
  
  // æª¢æŸ¥ ModuleSystem æ˜¯å¦å­˜åœ¨
  if (typeof ModuleSystem === 'undefined') {
    tests.push('<span class="error">âŒ ModuleSystem æœªå®šç¾©</span>');
    $results.html(tests.join('<br>'));
    return;
  } else {
    tests.push('<span class="success">âœ… ModuleSystem å·²å®šç¾©</span>');
  }
  
  // æª¢æŸ¥æ ¸å¿ƒæ–¹æ³•
  const methods = ['register', 'get', 'init', 'status'];
  for (const method of methods) {
    if (typeof ModuleSystem[method] === 'function') {
      tests.push(`<span class="success">âœ… ModuleSystem.${method} å¯ç”¨</span>`);
    } else {
      tests.push(`<span class="error">âŒ ModuleSystem.${method} ä¸å¯ç”¨</span>`);
    }
  }
  
  // æª¢æŸ¥æ¨¡çµ„è¨»å†Šç‹€æ…‹
  try {
    const status = ModuleSystem.status();
    tests.push(`<span class="info">ğŸ“Š å·²è¨»å†Šæ¨¡çµ„: ${status.modules.join(', ')}</span>`);
    tests.push(`<span class="info">ğŸ“Š å·²è¼‰å…¥å¯¦ä¾‹: ${status.loadedModules.join(', ')}</span>`);
  } catch (error) {
    tests.push(`<span class="error">âŒ ç„¡æ³•ç²å–æ¨¡çµ„ç‹€æ…‹: ${error.message}</span>`);
  }
  
  $results.html(tests.join('<br>'));
}

// æ¸¬è©¦å€‹åˆ¥æ¨¡çµ„
async function testIndividualModules() {
  const $results = $('#individualResults');
  $results.html('<p>æ¸¬è©¦ä¸­...</p>');
  
  const modules = ['config', 'cangjie', 'charFilter', 'ui', 'app'];
  const results = [];
  
  for (const moduleName of modules) {
    try {
      const module = await ModuleSystem.get(moduleName);
      if (module && module.initialized) {
        results.push(`<span class="success">âœ… ${moduleName} æ¨¡çµ„æ­£å¸¸</span>`);
      } else if (module) {
        results.push(`<span class="warning">âš ï¸ ${moduleName} æ¨¡çµ„æœªåˆå§‹åŒ–</span>`);
      } else {
        results.push(`<span class="error">âŒ ${moduleName} æ¨¡çµ„ç²å–å¤±æ•—</span>`);
      }
    } catch (error) {
      results.push(`<span class="error">âŒ ${moduleName} éŒ¯èª¤: ${error.message}</span>`);
    }
  }
  
  $results.html(results.join('<br>'));
}

// å®Œæ•´æ‡‰ç”¨ç¨‹å¼æ¸¬è©¦
async function testFullApp() {
  const $results = $('#appResults');
  $results.html('<p>åŸ·è¡Œå®Œæ•´æ¸¬è©¦...</p>');
  
  try {
    // åˆå§‹åŒ–æ¨¡çµ„ç³»çµ±
    const result = await ModuleSystem.init(['config', 'cangjie', 'charFilter', 'ui', 'app']);
    
    const tests = [];
    
    if (result.success.length > 0) {
      tests.push(`<span class="success">âœ… æˆåŠŸè¼‰å…¥: ${result.success.join(', ')}</span>`);
    }
    
    if (result.failed.length > 0) {
      tests.push(`<span class="error">âŒ è¼‰å…¥å¤±æ•—: ${result.failed.map(f => f.name).join(', ')}</span>`);
      result.failed.forEach(failure => {
        tests.push(`<span class="error">   â””â”€ ${failure.name}: ${failure.error.message}</span>`);
      });
    }
    
    // æ¸¬è©¦æ ¸å¿ƒåŠŸèƒ½
    try {
      const app = await ModuleSystem.get('app');
      const ui = await ModuleSystem.get('ui');
      
      tests.push('<span class="success">âœ… æ‡‰ç”¨ç¨‹å¼å¯¦ä¾‹ç²å–æˆåŠŸ</span>');
      tests.push('<span class="success">âœ… UI å¯¦ä¾‹ç²å–æˆåŠŸ</span>');
      
      // æ¸¬è©¦é é¢æª¢æ¸¬
      const pageType = app.pageType;
      tests.push(`<span class="info">ğŸ“„ æª¢æ¸¬åˆ°é é¢é¡å‹: ${pageType}</span>`);
      
    } catch (error) {
      tests.push(`<span class="error">âŒ æ‡‰ç”¨ç¨‹å¼æ¸¬è©¦å¤±æ•—: ${error.message}</span>`);
    }
    
    $results.html(tests.join('<br>'));
    
  } catch (error) {
    $results.html(`<span class="error">âŒ å®Œæ•´æ¸¬è©¦å¤±æ•—: ${error.message}</span>`);
  }
}

// è‡ªå‹•åŸ·è¡ŒåŸºæœ¬æª¢æŸ¥
$(function() {
  setTimeout(() => {
    console.log('ğŸ”§ èª¿è©¦å·¥å…·å·²è¼‰å…¥ï¼ŒåŸ·è¡ŒåŸºæœ¬æª¢æŸ¥...');
    checkFiles();
  }, 1000);
});
</script>

</body>
</html>